node_types:
  microcloud.container:
    properties:
      image_type:
        type: string
      image:
        type: string
      port_bindings:
        type: list
        entry_schema: map
      run_parameters:
        type: string
    interfaces:
      on_dependency_scale:
        description: "Hook called when one or more nodes of a dependent tier change"
      on_node_scale:
        description: "Hook called when the resources (cpu, memory) allocated to the container change"

  microcloud.container.docker:
    derived_from: microcloud.container
    properties:
      image_type: 'docker'

  microcloud.tier:
    properties:
      name:
        type: string
      max_nodes:
        type: integer
      container_type:
        type: microcloud.container
      thresholds:
        type: map
      depends_on:
        type: list
        entry_schema: string

  microcloud.app:
    properties:
      name:
        type: string
      tiers:
        type: list # I'm using list with singleton map inside to preserve order
        entry_schema:
          type: map
          entry_schema: microcloud.tier

  microcloud.infrastructure:
    properties:
      provider_name:
        type: string
      max_vms:
        type: integer
      vm_flavor:
          type: string
      vm_image:
          type: string
      api_key:
        type: { get_input: api_key }
      api_secret:
        type: { get_input: api_secret }

  microcloud.infrastructure.aws:
    derived_from: microcloud.infrastructure
    properties:
      provider_name: 'aws-ec2'
